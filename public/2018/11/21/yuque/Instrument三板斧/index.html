<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Leafly的博客"><title>Instrument三板斧 | Leafly</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Instrument三板斧</h1><a id="logo" href="/.">Leafly</a><p class="description">talk is cheap, show me the code</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Instrument三板斧</h1><div class="post-meta">Nov 21, 2018<span> | </span><span class="category"><a href="/categories/iOS/">iOS</a></span></div><div class="post-content"><p>作为开发，不仅仅要会开发功能，还需要关注产品的性能，苹果为我们提供了强大的性能检测功能Instrument。这里总结一下Instrument的三个常用功能。</p>
<p><a name="u7avsg"></a></p>
<h4 id="CPU性能"><a href="#CPU性能" class="headerlink" title="CPU性能"></a><a href="#u7avsg"></a>CPU性能</h4><p>Instrument有一个<strong>Timer Profiler</strong>选项，选择<strong>Timer Profiler</strong>模块运行你想要检测的应用即可得到它的CPU性能的结果：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/183307/1548062488952-32b82364-c834-417d-be0e-5c6c065f6e53.png#align=left&amp;display=inline&amp;height=442&amp;originHeight=532&amp;originWidth=900&amp;status=done&amp;width=747" alt=""></p>
<ul>
<li><p>可以在时间轴里选择一段时间查看该段时间更为细节的CPU性能</p>
</li>
<li><p>可以在Call Tree里选择调用栈的展现形式，更加方便问题定位</p>
</li>
<li><p>如果CPU过高会导致手机耗电甚至发热，列表滚动中CPU过高也有可能导致掉帧</p>
</li>
</ul>
<p><a name="bysosy"></a></p>
<h4 id="图形性能"><a href="#图形性能" class="headerlink" title="图形性能"></a><a href="#bysosy"></a>图形性能</h4><p>图形性能方面最关注的应该就是「帧率」了，也就是我们常说的FPS。在Instrument中使用<strong>Core Animation</strong> + <strong>Time Profiler</strong>来评估图形性能。<br>除了观察时间轴上的FPS情况，也可以在控制台中选择Core Animation FPS Measurements来观察FPS的情况，在屏幕滑动时，FPS越高表示性能越好，帧率过低则意味着屏幕可能会出现卡顿。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/183307/1548063371611-be58f216-99e0-49fa-9920-e631f3771c5a.png#align=left&amp;display=inline&amp;height=512&amp;originHeight=548&amp;originWidth=800&amp;status=done&amp;width=747" alt=""></p>
<p>除了FPS还有很多选项可以检测图形性能，在Xcode 9之前这些选项在右下角的区域（如上图），Xcode 9之后这些选择在Xcode的Debug菜单中<br><img src="https://cdn.nlark.com/yuque/0/2019/png/183307/1548064256231-96434508-1f01-4d2b-b52e-cbfba03a1ddf.png#align=left&amp;display=inline&amp;height=387&amp;originHeight=676&amp;originWidth=1306&amp;status=done&amp;width=747" alt=""></p>
<p>下面着重介绍一下这些选项的作用：</p>
<ul>
<li><p>Color Blended Layers 这个选项基于渲染程度对屏幕中的混合区域进行绿到红的高亮显示，越红表示性能越差，会对帧率等指标造成较大的影响。红色通常是由于多个半透明的图层叠加引起</p>
</li>
<li><p>Color Hits Green and Misses Red 当开启栅格化时，耗时的图片绘制会被缓存，当做一个简单的扁平图片来呈现，如果页面的其他区块使用缓存直接命中，就显示绿色，反之就显示红色。红色越多，性能越差，因为栅格化生成缓存的过程是有开销的，如果缓存能被大量命中和有效使用，则总体会降低开销，反之则意味着频繁生成新的缓存，这会让性能问题雪上加霜</p>
</li>
<li><p>Color Copied Images 对于GPU不支持的色彩格式的图片只能由CPU处理，这样的图片会标为蓝色，蓝色越多性能越差</p>
</li>
<li><p>Color Immediately 通常以每毫秒10次的频率更新图层调试颜色，对某些效果来说可能太慢了，这个选项可以用来设置每帧都更新</p>
</li>
<li><p>Color Misaligned Images 这个选项用来检查图片是否被缩放以及像素是否对齐，被缩放的图片会被标记为黄色，像素不对齐则会标注为紫色。黄色、紫色越多，性能越差</p>
</li>
<li><p>Color Offscreen-Rendered Yellow 这个选项会把离屏渲染的图层显示为黄色，黄色越多，性能越差，这些显示为黄色的图层很可能需要用 shadowPath 或者 shouldRasterize来优化</p>
</li>
<li><p>Color OpenGL Fast Path Blue 这个选项会把任何直接使用OpenGL绘制的图层显示为蓝色。蓝色越多，性能越好</p>
</li>
<li><p>Flash Update Regions 这个选项会把重绘的内容显示为黄色，不该出现的黄色越多，性能越差。</p>
</li>
</ul>
<p><a name="2ekfyu"></a></p>
<h4 id="内存性能"><a href="#内存性能" class="headerlink" title="内存性能"></a><a href="#2ekfyu"></a>内存性能</h4><ul>
<li><p>全局内存使用情况：从全局的角度监测应用的内存使用情况，捕捉非预期的或大幅度的内存增长</p>
</li>
<li><p>内存泄漏：未被程序引用，同时也不能被使用或释放的内存</p>
</li>
<li><p>废弃内存：被程序引用，但是没有任何作用的内存</p>
</li>
<li><p>僵尸对象：对应的内存已经被释放并且不再会使用到，但是程序依然指向它的引用</p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/183307/1548068035204-9b36b29a-e575-4149-a2db-f9500e7fbf32.png#align=left&amp;display=inline&amp;height=479&amp;originHeight=513&amp;originWidth=800&amp;status=done&amp;width=747" alt=""><br><a name="uxuyny"></a></p>
<h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a><a href="#uxuyny"></a>注意点</h4><ul>
<li>如果使用Instrument查看调用栈时看到的都是地址而不是函数名，这就需要在项目的Build Settings - Debug Information Format的Debug 和 Release里设置为<strong>DWAF with dSYM File</strong>，这样才能将对应的堆栈信息符号化显示</li>
</ul>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/11/21/yuque/ZYRouterManager--Swift/">ZYRouterManager--Swift</a><a class="next" href="/2018/11/20/yuque/导航栏隐藏白条问题调研/">导航栏隐藏白条问题调研</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://ileafly.github.io/ileafly"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/">Flutter</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/实战/" style="font-size: 15px;">实战</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/01/07/yuque/Flutter--状态管理/">Flutter--状态管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/07/yuque/深入浅出CoreStore/">深入浅出CoreStore</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/25/yuque/iOS应用内购买开发流程/">iOS应用内购买开发流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/21/yuque/ZYRouterManager--Swift/">ZYRouterManager--Swift</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/21/yuque/Instrument三板斧/">Instrument三板斧</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/20/yuque/导航栏隐藏白条问题调研/">导航栏隐藏白条问题调研</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/10/yuque/Github+Hexo搭建个人博客详细教程/">Github+Hexo搭建个人博客详细教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/09/yuque/使用语雀管理博客/">使用语雀管理博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/08/yuque/fastlane指南/">fastlane指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/14/yuque/ZYLoading--自定义loading控件/">ZYLoading--自定义loading控件</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Leafly.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>