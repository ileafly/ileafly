<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Leafly的博客">
    <meta name="keyword" content="undefined">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        深入浅出CoreStore - Leafly的博客 | Leafly&#39;s Blog
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> talk is cheap, show me the code </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/img/avatar.jpeg">
        </div>
        <div class="name">
            <i>Leafly</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li>
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li>
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li>
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性"><span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基本用法"><span class="toc-text">基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据库插入"><span class="toc-text">数据库插入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据库查询"><span class="toc-text">数据库查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据库更新"><span class="toc-text">数据库更新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#数据库删除"><span class="toc-text">数据库删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库升级"><span class="toc-text">数据库升级</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input">
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i> talk is cheap, show me the code </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        深入浅出CoreStore
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2019-01-07 09:59:44</span></span>
        
        
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>

    </div>
    <div class="post-content ">
        <p><a href="https://github.com/JohnEstropia/CoreStore" target="_blank" rel="noopener">CoreStore</a>是一个使用Swift包装CoreData的框架，号称利用Swift语言的特性，优雅而又安全的释放CoreData的真正潜力。</p>
<p><a name="c666ad11"></a></p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li>充分利用了Swift语言的优雅和安全的特点</li>
<li>安全的并发架构 所有的更新都是通过串行事务完成的</li>
<li>清晰、便捷的查询API</li>
<li>类型安全，可以方便的配置监听</li>
<li>支持高效率的批量导入</li>
<li>支持纯Swift代码声明安全的成员变量，无需维护<strong>.xcdatamodeId</strong>文件</li>
<li>支持进阶式升级</li>
<li>支持自定义升级</li>
<li>支持一个<strong>DataStack</strong>管理多个存储对象</li>
</ul>
<p><a name="704f29e0"></a></p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p><a name="ef56a618"></a></p>
<h4 id="数据库插入"><a href="#数据库插入" class="headerlink" title="数据库插入"></a>数据库插入</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CoreStore</span>.perform(</span><br><span class="line">  asynchronous: &#123; (transaction) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> person = transaction.create(<span class="type">Into</span>&lt;<span class="type">MyPersonEntity</span>&gt;())</span><br><span class="line">        person.name = <span class="string">"John Smith"</span></span><br><span class="line">        person.age = <span class="number">42</span></span><br><span class="line">  &#125;,</span><br><span class="line">  completion: &#123; (result) -&gt; <span class="type">Void</span> <span class="keyword">in</span> </span><br><span class="line">        <span class="keyword">switch</span> result &#123;</span><br><span class="line">        <span class="keyword">case</span> .success: <span class="built_in">print</span>(<span class="string">"success!"</span>)</span><br><span class="line">        <span class="keyword">case</span> .failure(<span class="keyword">let</span> error): <span class="built_in">print</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><a name="9d876ea2"></a></p>
<h4 id="数据库查询"><a href="#数据库查询" class="headerlink" title="数据库查询"></a>数据库查询</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> people = <span class="type">CoreStore</span>.fetchAll(</span><br><span class="line">    <span class="type">From</span>&lt;<span class="type">MyPersonEntity</span>&gt;()</span><br><span class="line">        .<span class="keyword">where</span>(\.age &gt; <span class="number">30</span>),</span><br><span class="line">        .orderBy(.ascending(\.name), .descending(.\age)),</span><br><span class="line">        .tweak(&#123; $<span class="number">0</span>.includesPendingChanges = <span class="literal">false</span> &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> maxAge = <span class="type">CoreStore</span>.queryValue(</span><br><span class="line">    <span class="type">From</span>&lt;<span class="type">MyPersonEntity</span>&gt;()</span><br><span class="line">        .select(<span class="type">Int</span>.<span class="keyword">self</span>, .maximum(\.age))</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><a name="e1255531"></a></p>
<h4 id="数据库更新"><a href="#数据库更新" class="headerlink" title="数据库更新"></a>数据库更新</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CoreStore</span>.perform(asynchronous: &#123; (transaction) -&gt; <span class="type">Void</span> <span class="keyword">in</span> </span><br><span class="line">        <span class="keyword">let</span> predicate = <span class="type">NSPredicate</span>(format: <span class="string">"name = leafly"</span>)</span><br><span class="line">        <span class="keyword">let</span> person = transaction.fetchOne(<span class="type">From</span>&lt;<span class="type">MyPersonEntity</span>&gt;(),</span><br><span class="line">                                          <span class="type">Where</span>&lt;<span class="type">MyPersonEntity</span>&gt;(predicate))</span><br><span class="line">        preson.age = <span class="number">29</span></span><br><span class="line">  &#125;,</span><br><span class="line">  completion: &#123; (result) -&gt; <span class="type">Void</span> <span class="keyword">in</span> </span><br><span class="line">        <span class="keyword">switch</span> result &#123;</span><br><span class="line">        <span class="keyword">case</span> .success: <span class="built_in">print</span>(<span class="string">"success!"</span>)</span><br><span class="line">        <span class="keyword">case</span> .failure(<span class="keyword">let</span> error): <span class="built_in">print</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><a name="7118290c"></a></p>
<h4 id="数据库删除"><a href="#数据库删除" class="headerlink" title="数据库删除"></a>数据库删除</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> predicate = <span class="type">NSPredicate</span>(formate: <span class="string">"age = 30"</span>)</span><br><span class="line"><span class="type">CoreStore</span>.perform(asynchronous: &#123; (transaction) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">     transaction.deleteAll(<span class="type">From</span>&lt;<span class="type">MyPersonEntity</span>&gt;(),</span><br><span class="line">                           <span class="type">Where</span>&lt;<span class="type">MyPersonEntity</span>&gt;(predicate)</span><br><span class="line"> &#125;,</span><br><span class="line"> completion: &#123; (result) -&gt; <span class="type">Void</span> <span class="keyword">in</span> </span><br><span class="line">        <span class="keyword">switch</span> result &#123;</span><br><span class="line">        <span class="keyword">case</span> .success: <span class="built_in">print</span>(<span class="string">"success!"</span>)</span><br><span class="line">        <span class="keyword">case</span> .failure(<span class="keyword">let</span> error): <span class="built_in">print</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><a name="f895fc53"></a></p>
<h3 id="数据库升级"><a href="#数据库升级" class="headerlink" title="数据库升级"></a>数据库升级</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建dataStack 需要指明迁移路径</span></span><br><span class="line"><span class="keyword">let</span> dataStack = <span class="type">DataStack</span>(xcodeModelName: <span class="string">"Model"</span>, </span><br><span class="line">                          bundle: <span class="type">Bundle</span>.main, </span><br><span class="line">                          migrationChain: [<span class="string">"Model"</span>, <span class="string">"ModelV2"</span>])</span><br><span class="line"><span class="comment">// sqlite的路径</span></span><br><span class="line"><span class="keyword">let</span> sqliteFileURL = <span class="type">FileManager</span>.<span class="keyword">default</span>.urls(<span class="keyword">for</span>: systemDirectorySearchPath, <span class="keyword">in</span>: .userDomainMask).first!.appendingPathComponent(<span class="type">Bundle</span>.main.bundleIdentifier, isDirectory: <span class="literal">true</span>).appendingPathComponent(<span class="string">"Model.sqlite"</span>)</span><br><span class="line"><span class="comment">// addStorate</span></span><br><span class="line"><span class="number">_</span> = dataStack.addStorage(</span><br><span class="line">  <span class="type">SQLiteStore</span>(</span><br><span class="line">    fileURL: sqliteFileURL,</span><br><span class="line">    localStoreageOptions: .recreateStoreOnModelMismatch</span><br><span class="line">  ),</span><br><span class="line">  completion: &#123; (result) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">               <span class="keyword">switch</span> result &#123;</span><br><span class="line">                 <span class="keyword">case</span> .success(<span class="keyword">let</span> storage):</span><br><span class="line">                    <span class="comment">// 做一些数据库创建后的操作</span></span><br><span class="line">                 <span class="keyword">case</span> .failure(<span class="keyword">let</span> error):</span><br><span class="line">                    <span class="comment">// 数据库创建失败</span></span><br><span class="line">               &#125;</span><br><span class="line">              &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="type">CoreStore</span>.defaultStack = dataStack</span><br></pre></td></tr></table></figure>

        
        <br>
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank" href="https://github.com/luzhiyongGit">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = ""
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script type="text/javascript">
       (function() {
           if (typeof LivereTower === 'function') { return; }

           var j, d = document.getElementById('lv-container');

           d.setAttribute('data-id','city');
           d.setAttribute('data-uid' , 'MTAyMC80MTAwNC8xNzUyOQ==');

           j = document.createElement('script');
           j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
           j.async = true;

           d.appendChild(j);
       })();
    </script>
    <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
    </div>

</html>
